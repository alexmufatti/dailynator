<div class="config-shell">
  <mat-card class="panel-card">
    <mat-card-header>
      <mat-card-title>{{ selectedTeam()?.name ?? 'No team available' }}</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="button-row">
        <button matButton="elevated" (click)="startRename(selectedTeam()!)" [disabled]="!selectedTeam()">
          <mat-icon>edit</mat-icon>
          Rename
        </button>
        <button matButton="elevated" (click)="deleteTeam(activeTeamId())" [disabled]="teams().length === 1">
          <mat-icon>delete</mat-icon>
          Delete team
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="panel-card">
    <mat-card-header>
      <mat-card-title>Quote source</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="form-stack">
        <mat-form-field appearance="outline">
          <mat-label>Preferred source</mat-label>
          <mat-select [ngModel]="selectedTeam()?.subtitleSource || 'random'"
                      (ngModelChange)="changeSubtitleSource(selectedTeam()!, $event)">
            @for (opt of subtitleSourceOptions; track opt.value) {
              <mat-option [value]="opt.value">
                {{ opt.label }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>

  @if (renamingTeamId()) {
    <mat-card class="panel-card">
      <mat-card-header>
        <mat-card-title>Rename team</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-stack">
          <mat-form-field appearance="outline">
            <mat-label>New team name</mat-label>
            <input matInput [(ngModel)]="renameValue" (keyup.enter)="confirmRename()"/>
          </mat-form-field>
          <div class="button-row">
            <button matButton="filled" (click)="confirmRename()" [disabled]="!renameValue().trim()">
              <mat-icon>check</mat-icon>
              Save
            </button>
            <button matButton="elevated" (click)="cancelRename()">
              <mat-icon>close</mat-icon>
              Cancel
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  }

  <mat-card class="panel-card">
    <mat-card-header>
      <mat-card-title>Create a new team</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="form-stack">
        <mat-form-field appearance="outline">
          <mat-label>New team name</mat-label>
          <input matInput [(ngModel)]="newTeamName" placeholder="e.g. API Crew" (keyup.enter)="createTeam()"/>
        </mat-form-field>
        <button matButton="elevated" (click)="createTeam()" [disabled]="!newTeamName().trim()">
          <mat-icon>add</mat-icon>
          Create team
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="panel-card participants-card">
    <mat-card-header>
      <mat-card-title>Participants ({{ people.length }})</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="add-participant-inline">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Add participant</mat-label>
          <input matInput [(ngModel)]="newParticipant" (keyup)="onFieldKeyUp($event)" placeholder="Name and surname"/>
        </mat-form-field>
        <button matButton="elevated" (click)="addParticipant()" [disabled]="!newParticipant()">
          <mat-icon>person_add</mat-icon>
          Add
        </button>
      </div>

      <mat-divider></mat-divider>

      <mat-list role="list">
        @for (participant of people; let i = $index; track participant.name) {
          <mat-list-item>
            <div class="participant-row">
              <div class="participant-copy">
                <span class="name" [ngClass]="participant.present ? '' : 'away'">{{ participant.name }}</span>
                <span class="presence-chip" [class.away]="!participant.present">
                  {{ participant.present ? 'In' : 'Out' }}
                </span>
              </div>
              <div class="item-button-container">
                <button mat-icon-button (click)="removeParticipant(participant.name)"
                        aria-label="Remove {{ participant.name }}">
                  <mat-icon>delete</mat-icon>
                </button>
                <button mat-icon-button (click)="togglePresence(i)"
                        aria-label="Toggle attendance for {{ participant.name }}">
                  <mat-icon>@if (participant.present) {
                    beach_access
                  } @else {
                    apartment
                  }</mat-icon>
                </button>
              </div>
            </div>
          </mat-list-item>
        } @empty {
          <p class="participants-empty">No participants yet. Add them to populate the daily rotation.</p>
        }
      </mat-list>
    </mat-card-content>
  </mat-card>
</div>
