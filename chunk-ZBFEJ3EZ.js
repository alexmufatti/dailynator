import{a as Q,b as q,c as Y,d as Z,e as ee}from"./chunk-KUPLIPMR.js";import{a as ne,b as ae,c as ie}from"./chunk-RRX4RIBM.js";import{Ca as te,T as B,W as F,Y as R,b as N,ba as W,da as A,ea as L,ga as j,ia as U,ja as z,ka as K,la as $,ma as H,na as G,oa as J,ra as X}from"./chunk-RF2HZUNV.js";import{Bb as T,Db as p,Eb as g,Na as l,Qb as I,Sb as r,Tb as S,Ub as C,Vb as h,Wb as y,Xb as M,Y as _,Yb as O,ab as D,ac as k,ba as u,ca as f,na as d,nb as x,pb as b,qa as E,qb as v,sb as w,tb as P,ub as s,vb as a,wb as i,xb as V}from"./chunk-Q62LRIPF.js";var oe=[{value:"joke",label:"Battuta"},{value:"motivational",label:"Motivazionale"},{value:"random",label:"Casuale"},{value:"disabled",label:"Nessuna"}];var me=(m,e)=>e.value,pe=(m,e)=>e.name;function de(m,e){if(m&1&&(a(0,"mat-option",7),r(1),i()),m&2){let n=e.$implicit;s("value",n.value),l(),C(" ",n.label," ")}}function se(m,e){if(m&1){let n=T();a(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Rename team"),i()(),a(4,"mat-card-content")(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),r(8,"New team name"),i(),a(9,"input",15),M("ngModelChange",function(o){u(n);let c=g();return y(c.renameValue,o)||(c.renameValue=o),f(o)}),p("keyup.enter",function(){u(n);let o=g();return f(o.confirmRename())}),i()(),a(10,"div",2)(11,"button",16),p("click",function(){u(n);let o=g();return f(o.confirmRename())}),a(12,"mat-icon"),r(13,"check"),i(),r(14," Save "),i(),a(15,"button",17),p("click",function(){u(n);let o=g();return f(o.cancelRename())}),a(16,"mat-icon"),r(17,"close"),i(),r(18," Cancel "),i()()()()()}if(m&2){let n=g();l(9),h("ngModel",n.renameValue),l(2),s("disabled",!n.renameValue().trim())}}function ge(m,e){m&1&&r(0," beach_access ")}function ue(m,e){m&1&&r(0," apartment ")}function fe(m,e){if(m&1){let n=T();a(0,"mat-list-item")(1,"div",18)(2,"div",19)(3,"span",20),r(4),i(),a(5,"span",21),r(6),i()(),a(7,"div",22)(8,"button",23),p("click",function(){let o=u(n).$implicit,c=g();return f(c.removeParticipant(o.name))}),a(9,"mat-icon"),r(10,"delete"),i()(),a(11,"button",23),p("click",function(){let o=u(n).$index,c=g();return f(c.togglePresence(o))}),a(12,"mat-icon"),b(13,ge,1,0)(14,ue,1,0),i()()()()()}if(m&2){let n=e.$implicit;l(3),s("ngClass",n.present?"":"away"),l(),S(n.name),l(),I("away",!n.present),l(),C(" ",n.present?"In":"Out"," "),l(2),x("aria-label",O("Remove ",n.name)),l(3),x("aria-label",O("Toggle attendance for ",n.name)),l(2),v(n.present?13:14)}}function _e(m,e){m&1&&(a(0,"p",14),r(1,"No participants yet. Add them to populate the daily rotation."),i())}var re=class m{storage=_(A);communication=_(G);snackBar=_(ae);newParticipant=d("");people=[];teams=d([]);activeTeamId=d("");newTeamName=d("");renamingTeamId=d(null);renameValue=d("");selectedTeam=k(()=>this.storage.getTeam(this.activeTeamId()));subtitleSourceOptions=oe;workingDays=d(10);averageVelocity=d(0);vacationDaysMap=d(new Map);estimatedVelocity=k(()=>this.calculateEstimatedVelocity());constructor(){E(()=>{this.teams.set(this.storage.getTeams()()),this.activeTeamId.set(this.storage.getActiveTeamId()());let e=this.storage.getActiveTeam();this.people=e?.participants??[],this.renamingTeamId()&&this.renamingTeamId()===e?.id&&this.renameValue.set(e?.name??""),this.loadSprintCapacity()})}loadSprintCapacity(){let e=this.storage.getActiveTeam();if(e?.sprintCapacity){let n=e.sprintCapacity;this.workingDays.set(n.workingDays),this.averageVelocity.set(n.averageVelocity);let t=new Map;n.vacationDays.forEach(o=>{t.set(o.participantName,o.vacationDays)}),this.vacationDaysMap.set(t)}else this.workingDays.set(10),this.averageVelocity.set(0),this.vacationDaysMap.set(new Map)}calculateEstimatedVelocity(){let e=this.workingDays(),n=this.people.length;if(n===0||e===0||this.averageVelocity()===0)return 0;let t=0;this.people.forEach(le=>{t+=this.vacationDaysMap().get(le.name)||0});let c=n*e-t,ce=this.averageVelocity()/(n*e);return Math.round(ce*c*10)/10}addParticipant(){this.newParticipant()&&(this.people.push({name:this.newParticipant(),present:!0}),this.save(),this.newParticipant.set(""))}save(){this.storage.setPeople(this.people),this.communication.changeMessage("aa")}startRename(e){e&&(this.renamingTeamId.set(e.id),this.renameValue.set(e.name))}confirmRename(){this.renamingTeamId()&&(this.storage.renameTeam(this.renamingTeamId(),this.renameValue()),this.renamingTeamId.set(null),this.communication.changeMessage("team-renamed"))}cancelRename(){this.renamingTeamId.set(null),this.renameValue.set("")}createTeam(){this.storage.addTeam(this.newTeamName()),this.newTeamName.set(""),this.communication.changeMessage("team-changed")}deleteTeam(e){this.storage.deleteTeam(e),this.communication.changeMessage("team-changed"),this.renamingTeamId()===e&&this.cancelRename()}togglePresence(e){this.people[e].present=!this.people[e].present,this.save()}removeParticipant(e){let n=this.people.findIndex(t=>t.name===e);this.people.splice(n,1),this.save()}onFieldKeyUp(e){e.key==="Enter"&&this.addParticipant()}changeSubtitleSource(e,n){this.storage.setTeamSubtitleSource(e.id,n),e.id===this.activeTeamId()&&this.communication.changeMessage("daily-subtitle-config-changed"),this.showSubtitleSavedToast(e.name)}showSubtitleSavedToast(e){this.snackBar.open(`Sorgente aggiornata per ${e}`,"OK",{duration:3e3})}static \u0275fac=function(n){return new(n||m)};static \u0275cmp=D({type:m,selectors:[["app-config"]],decls:61,vars:11,consts:[[1,"config-shell"],[1,"panel-card"],[1,"button-row"],["matButton","elevated",3,"click","disabled"],[1,"form-stack"],["appearance","outline"],[3,"ngModelChange","ngModel"],[3,"value"],["matInput","","placeholder","e.g. API Crew",3,"ngModelChange","keyup.enter","ngModel"],[1,"panel-card","participants-card"],[1,"add-participant-inline"],["appearance","outline",1,"full-width"],["matInput","","placeholder","Name and surname",3,"ngModelChange","keyup","ngModel"],["role","list"],[1,"participants-empty"],["matInput","",3,"ngModelChange","keyup.enter","ngModel"],["matButton","filled",3,"click","disabled"],["matButton","elevated",3,"click"],[1,"participant-row"],[1,"participant-copy"],[1,"name",3,"ngClass"],[1,"presence-chip"],[1,"item-button-container"],["mat-icon-button","",3,"click","aria-label"]],template:function(n,t){if(n&1&&(a(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title"),r(4),i()(),a(5,"mat-card-content")(6,"div",2)(7,"button",3),p("click",function(){return t.startRename(t.selectedTeam())}),a(8,"mat-icon"),r(9,"edit"),i(),r(10," Rename "),i(),a(11,"button",3),p("click",function(){return t.deleteTeam(t.activeTeamId())}),a(12,"mat-icon"),r(13,"delete"),i(),r(14," Delete team "),i()()()(),a(15,"mat-card",1)(16,"mat-card-header")(17,"mat-card-title"),r(18,"Quote source"),i()(),a(19,"mat-card-content")(20,"div",4)(21,"mat-form-field",5)(22,"mat-label"),r(23,"Preferred source"),i(),a(24,"mat-select",6),p("ngModelChange",function(c){return t.changeSubtitleSource(t.selectedTeam(),c)}),w(25,de,2,2,"mat-option",7,me),i()()()()(),b(27,se,19,2,"mat-card",1),a(28,"mat-card",1)(29,"mat-card-header")(30,"mat-card-title"),r(31,"Create a new team"),i()(),a(32,"mat-card-content")(33,"div",4)(34,"mat-form-field",5)(35,"mat-label"),r(36,"New team name"),i(),a(37,"input",8),M("ngModelChange",function(c){return y(t.newTeamName,c)||(t.newTeamName=c),c}),p("keyup.enter",function(){return t.createTeam()}),i()(),a(38,"button",3),p("click",function(){return t.createTeam()}),a(39,"mat-icon"),r(40,"add"),i(),r(41," Create team "),i()()()(),a(42,"mat-card",9)(43,"mat-card-header")(44,"mat-card-title"),r(45),i()(),a(46,"mat-card-content")(47,"div",10)(48,"mat-form-field",11)(49,"mat-label"),r(50,"Add participant"),i(),a(51,"input",12),M("ngModelChange",function(c){return y(t.newParticipant,c)||(t.newParticipant=c),c}),p("keyup",function(c){return t.onFieldKeyUp(c)}),i()(),a(52,"button",3),p("click",function(){return t.addParticipant()}),a(53,"mat-icon"),r(54,"person_add"),i(),r(55," Add "),i()(),V(56,"mat-divider"),a(57,"mat-list",13),w(58,fe,15,10,"mat-list-item",null,pe,!1,_e,2,0,"p",14),i()()()()),n&2){let o,c;l(4),S(((o=t.selectedTeam())==null?null:o.name)??"No team available"),l(3),s("disabled",!t.selectedTeam()),l(4),s("disabled",t.teams().length===1),l(13),s("ngModel",((c=t.selectedTeam())==null?null:c.subtitleSource)||"random"),l(),P(t.subtitleSourceOptions),l(2),v(t.renamingTeamId()?27:-1),l(10),h("ngModel",t.newTeamName),l(),s("disabled",!t.newTeamName().trim()),l(7),C("Participants (",t.people.length,")"),l(6),h("ngModel",t.newParticipant),l(),s("disabled",!t.newParticipant()),l(6),P(t.people)}},dependencies:[W,B,F,R,j,X,te,L,ne,J,Q,q,N,U,K,z,$,H,ee,Z,Y,ie],styles:[".config-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;padding:20px;max-width:800px;margin:0 auto}.team-card[_ngcontent-%COMP%], .project-card[_ngcontent-%COMP%]{width:100%}.team-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:16px 0}.field-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:10px;flex-wrap:wrap}.full-width[_ngcontent-%COMP%]{flex:1;min-width:250px}.team-select-field[_ngcontent-%COMP%]{flex:1;min-width:200px}.rename-section[_ngcontent-%COMP%]{background-color:#3f51b50d;padding:12px;border-radius:4px;border-left:4px solid #3f51b5}.create-team-section[_ngcontent-%COMP%]{margin-top:8px}.add-participant-section[_ngcontent-%COMP%]{margin:20px;padding:16px;background-color:#00000005;border-radius:8px}mat-divider[_ngcontent-%COMP%]{margin:12px 0}.list-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid #ccc}h3.away[_ngcontent-%COMP%]{text-decoration:line-through}.list-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin:20px}mat-list-item[_ngcontent-%COMP%]{border-bottom:1px solid var(--mat-sys-on-surface)}.participant-card[_ngcontent-%COMP%]{max-width:100%}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px}mat-card-header[_ngcontent-%COMP%]{margin-bottom:16px}mat-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500}.config-shell[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;padding:16px;max-width:520px;margin:0 auto}.team-summary[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;padding:16px;background:#00000008;border-radius:12px;border:1px solid rgba(0,0,0,.08)}@media(prefers-color-scheme:dark){.team-summary[_ngcontent-%COMP%]{background:#ffffff0d;border-color:#ffffff1f}}.summary-copy[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.4rem}.eyebrow[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:.08em;font-size:.75rem;color:#0009;margin:0 0 4px}.helper-text[_ngcontent-%COMP%]{color:#000000b3;margin:0}@media(prefers-color-scheme:dark){.eyebrow[_ngcontent-%COMP%]{color:#fff9}.helper-text[_ngcontent-%COMP%]{color:#ffffffb3}}.summary-actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.panel-card[_ngcontent-%COMP%]{width:100%}.form-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.button-row[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}.add-participant-inline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.participants-card[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.participant-row[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center;gap:12px}.participant-copy[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:4px;min-width:0}.participant-copy[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:500;color:#000000de}.participant-copy[_ngcontent-%COMP%]   .name.away[_ngcontent-%COMP%]{text-decoration:line-through;color:#00000080}@media(prefers-color-scheme:dark){.participant-copy[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{color:#ffffffde}}.presence-chip[_ngcontent-%COMP%]{font-size:.75rem;padding:2px 8px;border-radius:999px;background:#3f51b51f;color:#3f51b5;width:fit-content}.presence-chip.away[_ngcontent-%COMP%]{background:#9e9e9e33;color:#0009}@media(prefers-color-scheme:dark){.participant-copy[_ngcontent-%COMP%]   .name.away[_ngcontent-%COMP%]{color:#ffffff80}.presence-chip[_ngcontent-%COMP%]{background:#8b9ef933;color:#8b9ef9}.presence-chip.away[_ngcontent-%COMP%]{background:#9e9e9e4d;color:#fff9}}.item-button-container[_ngcontent-%COMP%]{display:flex;gap:6px}.participants-empty[_ngcontent-%COMP%]{font-style:italic;color:#0009;margin:16px 0 0}@media(prefers-color-scheme:dark){.participants-empty[_ngcontent-%COMP%]{color:#fff9}}@media(min-width:640px){.summary-actions[_ngcontent-%COMP%]{flex-direction:row;justify-content:flex-start}.add-participant-inline[_ngcontent-%COMP%]{flex-direction:row;align-items:flex-start}.add-participant-inline[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{align-self:flex-start}}"]})};export{re as ConfigComponent};
