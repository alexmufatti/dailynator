import{a as G,b as J,c as Q}from"./chunk-IJCLVJSR.js";import{$ as I,Ba as q,S as V,V as k,X as O,Y as E,_ as T,aa as N,ca as z,fa as A,ha as F,ia as B,ja as $,ka as j,la as W,ma as H,na as K,qa as L}from"./chunk-DWH4LLRD.js";import{Ab as v,Eb as P,Gb as m,Hb as u,Pa as p,Vb as o,Wb as f,ba as d,eb as x,fc as h,ga as C,gc as S,ha as M,qa as l,sb as _,tb as D,vb as w,wb as b,xb as g,yb as i,zb as n}from"./chunk-GIQBAP5G.js";var X=(r,e)=>e.name;function Y(r,e){if(r&1){let a=P();i(0,"div",9)(1,"span",15),o(2),n(),i(3,"mat-form-field",16)(4,"mat-label"),o(5,"Days off"),n(),i(6,"input",17),m("ngModelChange",function(c){let s=C(a).$implicit,y=u();return M(y.updateVacationDays(s.name,c))}),n()()()}if(r&2){let a=e.$implicit,t=u();p(2),f(a.name),p(4),g("ngModel",t.getVacationDays(a.name))("max",t.workingDays())}}function Z(r,e){r&1&&(i(0,"p",10),o(1,"Add participants in the Config tab to set their vacation days"),n())}function tt(r,e){r&1&&(i(0,"p",13),o(1,"Enter working days and average velocity to see the estimate"),n())}var R=class r{storage=d(z);communication=d(H);snackBar=d(J);activeTeamId=l("");selectedTeam=h(()=>this.storage.getTeam(this.activeTeamId()));people=[];workingDays=l(10);averageVelocity=l(0);vacationDaysMap=l(new Map);estimatedVelocity=h(()=>this.calculateEstimatedVelocity());constructor(){S(()=>{this.activeTeamId.set(this.storage.getActiveTeamId()());let e=this.storage.getActiveTeam();this.people=e?.participants??[],this.loadSprintCapacity()})}loadSprintCapacity(){let e=this.storage.getActiveTeam();if(e?.sprintCapacity){let a=e.sprintCapacity;this.workingDays.set(a.workingDays),this.averageVelocity.set(a.averageVelocity);let t=new Map;a.vacationDays.forEach(c=>{t.set(c.participantName,c.vacationDays)}),this.vacationDaysMap.set(t)}else this.workingDays.set(10),this.averageVelocity.set(0),this.vacationDaysMap.set(new Map)}calculateEstimatedVelocity(){let e=this.workingDays(),a=this.people.length;if(a===0||e===0||this.averageVelocity()===0)return 0;let t=0;this.people.forEach(U=>{t+=this.vacationDaysMap().get(U.name)||0});let s=a*e-t,y=this.averageVelocity()/(a*e);return Math.round(y*s*10)/10}updateVacationDays(e,a){let t=new Map(this.vacationDaysMap());t.set(e,a),this.vacationDaysMap.set(t)}getVacationDays(e){return this.vacationDaysMap().get(e)||0}saveSprintCapacity(){let e=this.people.map(t=>({participantName:t.name,vacationDays:this.vacationDaysMap().get(t.name)||0})),a={workingDays:this.workingDays(),vacationDays:e,averageVelocity:this.averageVelocity()};this.storage.setTeamSprintCapacity(this.activeTeamId(),a),this.communication.changeMessage("sprint-capacity-changed"),this.snackBar.open("Sprint capacity saved","OK",{duration:3e3})}static \u0275fac=function(a){return new(a||r)};static \u0275cmp=x({type:r,selectors:[["app-capacity"]],decls:36,vars:5,consts:[[1,"capacity-shell"],[1,"panel-card"],[1,"form-stack"],[1,"description"],[1,"form-section"],["appearance","outline"],["matInput","","type","number","min","1","max","30","placeholder","e.g., 10",3,"ngModelChange","ngModel"],["matInput","","type","number","min","0","step","0.5","placeholder","e.g., 35",3,"ngModelChange","ngModel"],[1,"vacation-section"],[1,"vacation-row"],[1,"empty-text"],[1,"capacity-result"],[1,"velocity-value"],[1,"hint-text"],["mat-flat-button","","color","primary",3,"click"],[1,"participant-name"],["appearance","outline",1,"vacation-input"],["matInput","","type","number","min","0","placeholder","0",3,"ngModelChange","ngModel","max"]],template:function(a,t){a&1&&(i(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title"),o(4,"Sprint Capacity Calculator"),n()(),i(5,"mat-card-content")(6,"div",2)(7,"p",3),o(8," Calculate the estimated velocity for the current sprint based on working days, team size, and vacation days. "),n(),i(9,"div",4)(10,"mat-form-field",5)(11,"mat-label"),o(12,"Working days in sprint"),n(),i(13,"input",6),m("ngModelChange",function(s){return t.workingDays.set(s)}),n()(),i(14,"mat-form-field",5)(15,"mat-label"),o(16,"Average velocity (last sprints)"),n(),i(17,"input",7),m("ngModelChange",function(s){return t.averageVelocity.set(s)}),n()()(),v(18,"mat-divider"),i(19,"div",8)(20,"h4"),o(21,"Vacation days per participant"),n(),w(22,Y,7,3,"div",9,X,!1,Z,2,0,"p",10),n(),v(25,"mat-divider"),i(26,"div",11)(27,"h3"),o(28,"Estimated velocity for this sprint"),n(),i(29,"div",12),o(30),n(),_(31,tt,2,0,"p",13),n(),i(32,"button",14),m("click",function(){return t.saveSprintCapacity()}),i(33,"mat-icon"),o(34,"save"),n(),o(35," Save capacity "),n()()()()()),a&2&&(p(13),g("ngModel",t.workingDays()),p(4),g("ngModel",t.averageVelocity()),p(5),b(t.people),p(8),f(t.estimatedVelocity()),p(),D(t.estimatedVelocity()===0&&t.people.length>0?31:-1))},dependencies:[N,V,E,k,I,T,O,A,F,$,j,B,L,K,G,W,Q,q],styles:[".capacity-shell[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;padding:16px;max-width:520px;margin:0 auto}.panel-card[_ngcontent-%COMP%]{width:100%}.form-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.description[_ngcontent-%COMP%]{color:#0009;font-size:.9rem;margin:0 0 8px;line-height:1.5}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-divider[_ngcontent-%COMP%]{margin:8px 0}.vacation-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin:8px 0}.vacation-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;font-size:1rem;font-weight:500;color:#000000de}.vacation-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:16px;padding:8px 0}.participant-name[_ngcontent-%COMP%]{flex:1;font-weight:400;font-size:.95rem;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.vacation-input[_ngcontent-%COMP%]{width:140px;flex-shrink:0}.capacity-result[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3f51b514,#2196f314);border-radius:12px;padding:24px;text-align:center;margin:8px 0}.capacity-result[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;font-size:1rem;font-weight:400;color:#000000b3}.velocity-value[_ngcontent-%COMP%]{font-size:3rem;font-weight:600;color:#3f51b5;margin:0;line-height:1}.hint-text[_ngcontent-%COMP%]{font-size:.85rem;color:#00000080;margin:12px 0 0;font-style:italic}.empty-text[_ngcontent-%COMP%]{font-style:italic;color:#00000080;margin:8px 0;font-size:.9rem;text-align:center;padding:16px}button[_ngcontent-%COMP%]{width:100%}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}@media (min-width: 640px){.capacity-shell[_ngcontent-%COMP%]{padding:24px}.vacation-row[_ngcontent-%COMP%]{padding:10px 0}.vacation-input[_ngcontent-%COMP%]{width:160px}}.form-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}"]})};export{R as CapacityComponent};
